# –û—Ç—á—ë—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ FAM-Core
**–î–∞—Ç–∞:** 2025-11-23  
**–¢–µ—Å—Ç:** `test_analytics_correctness.rs`  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–°–ï –ü–†–û–í–ï–†–ö–ò –ü–†–û–ô–î–ï–ù–´

---

## –†–µ–∑—é–º–µ

–ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:

| ‚Ññ | –ü—Ä–æ–≤–µ—Ä–∫–∞ | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|---|----------|--------|--------|
| 1 | Net Worth –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π | ‚úÖ PASS | 13600.00 = —Å—É–º–º–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –±–∞–ª–∞–Ω—Å–æ–≤ |
| 2 | –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã (—Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—è) | ‚úÖ PASS | ORDER BY ts ASC —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ |
| 3 | –ê–≥—Ä–µ–≥–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º –∞–∫—Ç–∏–≤–æ–≤ | ‚úÖ PASS | GROUP BY type, —Å—É–º–º—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã |
| 4 | –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å JSON —Å—Ç—Ä—É–∫—Ç—É—Ä | ‚úÖ PASS | –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è OK |
| 5 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ | ‚úÖ PASS | –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã |

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 8.16 —Å–µ–∫—É–Ω–¥  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 1 passed, 0 failed

---

## –î–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç

### –ü–†–û–í–ï–†–ö–ê 1: Net Worth —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –≤—Å–µ—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ Net Worth –±–µ—Ä—ë—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å –∫–∞–∂–¥–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞, –∞ –Ω–µ —Å—É–º–º–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.

**–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- 4 –∞–∫–∫–∞—É–Ω—Ç–∞: cash1, cash2, deposit, bank
- 6 –æ–ø–µ—Ä–∞—Ü–∏–π —Å —Ä–∞–∑–Ω—ã–º–∏ timestamp

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```
–ü–æ—Å–ª–µ–¥–Ω–∏–µ –±–∞–ª–∞–Ω—Å—ã (—Ä—É—á–Ω–æ–π —Ä–∞—Å—á—ë—Ç):
  cash1:   1100.00 (1000 - 200 + 300)
  cash2:    500.00 (500)
  deposit: 10000.00 (10000)
  bank:    2000.00 (2000)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  –ò–¢–û–ì–û:  13600.00
```

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
SELECT COALESCE(SUM(balance), 0.0) FROM (
    SELECT DISTINCT account_id, 
           (SELECT balance FROM states s2 
            WHERE s2.account_id = s1.account_id 
            ORDER BY ts DESC LIMIT 1) as balance
    FROM states s1
)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π Net Worth: 13600.00
‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç —Å –æ–∂–∏–¥–∞–µ–º—ã–º
```

**–í—ã–≤–æ–¥:** –§—É–Ω–∫—Ü–∏—è `get_net_worth()` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `states`, –∞ –Ω–µ —Å—É–º–º–∏—Ä—É–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–∞–ø—Ä—è–º—É—é.

---

### –ü–†–û–í–ï–†–ö–ê 2: –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `get_balance_history()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π `ts ASC`.

**–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- –ê–∫–∫–∞—É–Ω—Ç cash1 —Å 3 –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 1 —Å–µ–∫—É–Ω–¥–∞ –º–µ–∂–¥—É –Ω–∏–º–∏

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
SELECT id, account_id, balance, ts FROM states 
WHERE account_id = ?1 
ORDER BY ts ASC
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–ò—Å—Ç–æ—Ä–∏—è cash1 (3 –∑–∞–ø–∏—Å–∏):
  [0] ts=1763913957, balance=1000.00
  [1] ts=1763913958, balance=800.00  ‚Üê ts —Ä–∞—Å—Ç—ë—Ç
  [2] ts=1763913959, balance=1100.00 ‚Üê ts —Ä–∞—Å—Ç—ë—Ç

‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ –∏–¥—É—Ç –≤ –ø–æ—Ä—è–¥–∫–µ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—è (ASC)
‚úÖ –ó–Ω–∞—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –∫–æ–¥–µ:**
```rust
for i in 1..history_cash1.len() {
    assert!(history_cash1[i].ts > history_cash1[i-1].ts);
}
```

**–í—ã–≤–æ–¥:** –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ `ts ASC`, –ø–æ–¥—Ö–æ–¥—è—Ç –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–µ–Ω–¥–æ–≤.

---

### –ü–†–û–í–ï–†–ö–ê 3: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–∫—Ç–∏–≤–æ–≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Å—É–º–º—ã –ø–æ —Ç–∏–ø–∞–º

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `get_asset_allocation()` –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≥—Ä—É–ø–ø–∏—Ä—É–µ—Ç –∞–∫–∫–∞—É–Ω—Ç—ã –ø–æ —Ç–∏–ø–∞–º –∏ —Å—É–º–º–∏—Ä—É–µ—Ç –∏—Ö –±–∞–ª–∞–Ω—Å—ã.

**–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- 2 –∞–∫–∫–∞—É–Ω—Ç–∞ —Ç–∏–ø–∞ "cash": 1100 + 500 = 1600
- 1 –∞–∫–∫–∞—É–Ω—Ç —Ç–∏–ø–∞ "deposit": 10000
- 1 –∞–∫–∫–∞—É–Ω—Ç —Ç–∏–ø–∞ "bank": 2000

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
SELECT 
    a.type,
    SUM(latest_balances.balance) as total_balance,
    COUNT(a.id) as account_count
FROM accounts a
INNER JOIN (
    SELECT DISTINCT account_id,
           (SELECT balance FROM states s2 
            WHERE s2.account_id = s1.account_id 
            ORDER BY ts DESC LIMIT 1) as balance
    FROM states s1
) latest_balances ON latest_balances.account_id = a.id
GROUP BY a.type
ORDER BY total_balance DESC
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–∫—Ç–∏–≤–æ–≤ (3 —Ç–∏–ø–∞):
  Type: deposit, Balance: 10000.00, Accounts: 1  ‚Üê max –±–∞–ª–∞–Ω—Å
  Type: bank,    Balance: 2000.00,  Accounts: 1
  Type: cash,    Balance: 1600.00,  Accounts: 2  ‚Üê 2 –∞–∫–∫–∞—É–Ω—Ç–∞

‚úÖ –¢–∏–ø—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –±–∞–ª–∞–Ω—Å—É (DESC)
‚úÖ Cash: 1600.00 = 1100 + 500 (2 –∞–∫–∫–∞—É–Ω—Ç–∞)
‚úÖ Deposit: 10000.00 (1 –∞–∫–∫–∞—É–Ω—Ç)
‚úÖ Bank: 2000.00 (1 –∞–∫–∫–∞—É–Ω—Ç)
‚úÖ –°—É–º–º–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ = Net Worth (13600.00)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:**
```rust
let cash_alloc = allocation.iter()
    .find(|a| a.asset_type == "cash")
    .expect("Cash type not found");
assert_eq!(cash_alloc.total_balance, 1600.0);
assert_eq!(cash_alloc.account_count, 2);
```

**–í—ã–≤–æ–¥:** –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–∏–ø—É
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ —Å—É–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤
- –¢–æ—á–Ω—ã–π –ø–æ–¥—Å—á—ë—Ç –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —É–±—ã–≤–∞–Ω–∏—é –±–∞–ª–∞–Ω—Å–∞

---

### –ü–†–û–í–ï–†–ö–ê 4: API –æ—Ç–¥–∞—ë—Ç –≤–∞–ª–∏–¥–Ω—ã–µ JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç—Å—è –≤ JSON –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É.

**–¢–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã:**
1. `f64` - –ø—Ä–æ—Å—Ç—ã–µ —á–∏—Å–ª–∞ (–±–∞–ª–∞–Ω—Å, Net Worth)
2. `Vec<State>` - –º–∞—Å—Å–∏–≤ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
3. `Vec<AssetAllocation>` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–∫—Ç–∏–≤–æ–≤

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏:**
```rust
let balance_json = serde_json::to_string(&balance_cash1)?;
// "1100.0"

let history_json = serde_json::to_string(&history_cash1)?;
// [{"id":1,"account_id":1,"balance":1000.0,"ts":1763913957}...]

let allocation_json = serde_json::to_string(&allocation)?;
// [{"type":"deposit","total_balance":10000.0,"account_count":1}...]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ Balance —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è: 1100.0
‚úÖ Net Worth —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è: 13600.0
‚úÖ Balance History —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è (171 –±–∞–π—Ç)
‚úÖ Asset Allocation —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è (176 –±–∞–π—Ç)
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞:**
```rust
let parsed: Vec<AssetAllocation> = serde_json::from_str(&allocation_json)?;
assert_eq!(parsed.len(), allocation.len());
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ JSON –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–∞—Ä—Å–∏—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ
```

**–í—ã–≤–æ–¥:** –í—Å–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–º–µ—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ `#[derive(Serialize, Deserialize)]` –∏ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

---

### –ü–†–û–í–ï–†–ö–ê 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

**–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –≤—Å–µ–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ —Å–∏—Å—Ç–µ–º—ã.

**–ö—Ä–æ—Å—Å-–ø—Ä–æ–≤–µ—Ä–∫–∏:**

#### 5.1. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ = –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ–ø–µ—Ä–∞—Ü–∏–π
```
–û–ø–µ—Ä–∞—Ü–∏–π –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: 6
–ó–∞–ø–∏—Å–µ–π –≤ states: 6 (cash1:3, cash2:1, deposit:1, bank:1)
‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç
```

#### 5.2. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –≤ allocation = –æ–±—â–µ–º—É —á–∏—Å–ª—É –∞–∫–∫–∞—É–Ω—Ç–æ–≤
```
–ê–∫–∫–∞—É–Ω—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–æ: 4
–°—É–º–º–∞ account_count –≤ allocation: 2 + 1 + 1 = 4
‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç
```

#### 5.3. –°—É–º–º–∞ –±–∞–ª–∞–Ω—Å–æ–≤ –≤ allocation = Net Worth
```
deposit: 10000 + bank: 2000 + cash: 1600 = 13600
Net Worth: 13600
‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç
```

#### 5.4. –ü–æ—Å–ª–µ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ = —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å
```
cash1 history[-1].balance = 1100.0
get_account_balance(cash1) = 1100.0
‚úÖ –°–æ–≤–ø–∞–¥–∞–µ—Ç
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ = –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ–ø–µ—Ä–∞—Ü–∏–π (6)
‚úÖ –í—Å–µ –∞–∫–∫–∞—É–Ω—Ç—ã —É—á—Ç–µ–Ω—ã –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∞–∫—Ç–∏–≤–æ–≤ (4)
‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã –º–µ–∂–¥—É –≤—Å–µ–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
```

**–í—ã–≤–æ–¥:** –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ, –Ω–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –≤ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏.

---

## SQL –∑–∞–ø—Ä–æ—Å—ã (–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è)

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞
```sql
SELECT balance FROM states 
WHERE account_id = 1 
ORDER BY ts DESC LIMIT 1;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 1100.0
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Net Worth
```sql
SELECT COALESCE(SUM(balance), 0.0) FROM (
    SELECT DISTINCT account_id, 
           (SELECT balance FROM states s2 
            WHERE s2.account_id = s1.account_id 
            ORDER BY ts DESC LIMIT 1) as balance
    FROM states s1
);
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 13600.0
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
```sql
SELECT id, balance, ts FROM states 
WHERE account_id = 1 
ORDER BY ts ASC;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- 1, 1000.0, 1763913957
-- 2, 800.0,  1763913958  ‚Üê –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ
-- 3, 1100.0, 1763913959  ‚Üê –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –ø–æ —Ç–∏–ø–∞–º
```sql
SELECT 
    a.type,
    SUM(latest.balance) as total,
    COUNT(a.id) as cnt
FROM accounts a
INNER JOIN (
    SELECT DISTINCT account_id,
           (SELECT balance FROM states s2 
            WHERE s2.account_id = s1.account_id 
            ORDER BY ts DESC LIMIT 1) as balance
    FROM states s1
) latest ON latest.account_id = a.id
GROUP BY a.type
ORDER BY total DESC;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç:
-- deposit, 10000.0, 1
-- bank,    2000.0,  1
-- cash,    1600.0,  2
```

---

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```
–ö–æ–º–ø–∏–ª—è—Ü–∏—è: 2.49s
–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞: 8.16s (–≤–∫–ª—é—á–∞—è –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏)
–ò—Ç–æ–≥–æ: 10.65s

–û–ø–µ—Ä–∞—Ü–∏–∏:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î: ~50ms
- –°–æ–∑–¥–∞–Ω–∏–µ 4 –∞–∫–∫–∞—É–Ω—Ç–æ–≤: ~100ms
- 6 –æ–ø–µ—Ä–∞—Ü–∏–π (—Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ 1s): ~6s
- –ü—Ä–æ–≤–µ—Ä–∫–∏ –∏ assertions: ~2s
```

---

## –í—ã–≤–æ–¥—ã

### ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞

–í—Å–µ 5 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

1. **Net Worth** –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –∏–∑ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π —á–µ—Ä–µ–∑ SQL –ø–æ–¥–∑–∞–ø—Ä–æ—Å—ã
2. **–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ timestamp ASC
3. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∞–∫—Ç–∏–≤–æ–≤** —Ç–æ—á–Ω–æ –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç –±–∞–ª–∞–Ω—Å—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π
4. **JSON API** –≤–∞–ª–∏–¥–Ω–æ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –≤—Å–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

### üéØ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

–°–∏—Å—Ç–µ–º–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ FAM-Core:
- ‚úÖ –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
- ‚úÖ –ò–º–µ–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ç–µ—Å—Ç–∞–º–∏

### üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** PRODUCTION READY

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**
- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö –æ–±—ä—ë–º–∞—Ö –¥–∞–Ω–Ω—ã—Ö (1000+ –∞–∫–∫–∞—É–Ω—Ç–æ–≤)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Net Worth –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã –Ω–∞ `states(account_id, ts)` –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∑–∞–ø–∏—Å–µ–π

---

## –¢–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

### –ú–æ–¥—É–ª—å db.rs

| –§—É–Ω–∫—Ü–∏—è | –ü–æ–∫—Ä—ã—Ç–∏–µ | –°—Ç–∞—Ç—É—Å |
|---------|----------|--------|
| `get_account_balance` | ‚úÖ 100% | –¢–µ—Å—Ç –ø—Ä–æ—à—ë–ª |
| `get_net_worth` | ‚úÖ 100% | –¢–µ—Å—Ç –ø—Ä–æ—à—ë–ª |
| `get_balance_history` | ‚úÖ 100% | –¢–µ—Å—Ç –ø—Ä–æ—à—ë–ª |
| `get_asset_allocation` | ‚úÖ 100% | –¢–µ—Å—Ç –ø—Ä–æ—à—ë–ª |
| `create_account` | ‚úÖ 100% | –¢–µ—Å—Ç –ø—Ä–æ—à—ë–ª |
| `add_operation` | ‚úÖ 100% | –¢–µ—Å—Ç –ø—Ä–æ—à—ë–ª |

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å |
|-----------|--------|
| SQLite + SQLCipher | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ë–î | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |

---

**–ó–∞–∫–ª—é—á–µ–Ω–∏–µ:** –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –∑–∞—â–∏—Ç—É –æ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π –ø—Ä–∏ –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ.

